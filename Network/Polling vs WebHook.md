풀링(Polling)과 웹훅(Webhooks)은 서버와 클라이언트 간의 데이터 교환 방식을 구분하는 용어

이들 간의 주요 차이는 데이터 교환 패턴과 이에 따른 리소스 사용에 있음. 

## 서비스 구조

이커머스 웹사이트를 예로 들어 서비스 구조를 알아 보겠음.

이커머스 사이트의 클라이언트는 API 게이트웨이를 통해 주문 서비스에 주문을 보내고, 주문 서비스는 결제 트랜잭션을 위해 결제 서비스로 이동. 

결제 서비스는 외부 결제 서비스 공급자(PSP)와 통신하여 거래를 완료.

## 풀링(Polling)이란?

풀링은 주로 클라이언트가 서버에 데이터를 요청하는 패턴입니다. 풀링 방식을 사용하면, 클라이언트는 주기적으로 서버에 연결하여 요청한 정보를 받아옴.

예를 들어, 이커머스 웹사이트에서 결제 서비스는 PSP(결제 서비스 공급자)에게 주문 상태를 묻는 것이 풀링임.

```java
while (true) {
    String status = PSP.getPaymentStatus(orderId);
    if ("completed".equals(status)) {
        break;
    }
    Thread.sleep(5000);
}

```

이 Java 코드는 결제 상태를 확인하기 위해 5초마다 PSP에게 요청을 보내는 풀링의 예시.

풀링 방식은 다음과 같은 특징이 있음

1. `상태 확인` : 클라이언트는 주기적으로 서버에 접속하여 데이터의 최신 상태를 확인함.
2. `서버 부하` : 주기적인 요청은 서버에 부하를 주고, 결과적으로 서버의 성능에 영향을 줄 수 있음.
3. `실시간성 부족` : 풀링 간격에 따라 실시간 업데이트에 지연이 발생할 수 있음.

풀링의 가장 큰 문제는 `비효율성`임. 

서버에 데이터가 없을 때도 클라이언트는 계속해서 요청을 보내야 함. 

또한, 외부 서비스가 직접 결제 서비스와 통신하므로 보안 취약점이 생길 수 있음.

## 웹훅(Webhook)이란?

웹훅은 서버가 클라이언트에게 데이터를 푸시하는 패턴. 

웹훅을 사용하면, 클라이언트는 서버에 한 번만 요청을 보내고, 서버는 데이터가 준비되면 클라이언트에게 푸시.

결제 서비스에서는 PSP에 웹훅을 등록할 수 있음. 

이는 "요청에 대한 업데이트가 있을 때 특정 URL로 알려줘"라는 뜻.

그러면 PSP는 처리가 완료되면 HTTP 요청을 호출하여 결제 상태를 업데이트함.

```java
@PostMapping("/webhook")
public void webhook(@RequestBody PaymentStatusUpdate update) {
    if ("completed".equals(update.getStatus())) {
        // Handle the completed payment
    }
}

```

이 Java 코드는 웹훅의 엔드포인트를 설정하는 간단한 예.

여기서 PSP가 결제 완료를 알리면 해당 코드가 실행됨.

웹훅 방식은 다음과 같은 특징이 있음

1. `서버에서 클라이언트로 푸시` : 클라이언트가 요청하지 않아도 서버에서 데이터 업데이트를 클라이언트에게 알림.
2. `서버 부하 감소` : 클라이언트가 주기적으로 요청을 보내지 않으므로 서버 부하가 감소합니다.
3. `실시간성 향상` : 데이터가 변경될 때 즉시 알림을 받기 때문에 실시간성이 향상됩니다.

그러나 웹훅은 PSP가 콜백을 하지 않을 경우에 대비해 추가적인 대응책이 필요함. 

이런 경우에는 주기적인 `하우스키핑` 작업을 설정하여 결제 상태를 체크하는 것이 필요할 수 있음.

## 하우스키핑이란?

`하우스키핑`은 일종의 정비 작업을 말함. 

시스템이 어떤 작업을 수행하는 동안 발생할 수 있는 잘못된 상태나 이상한 데이터를 처리하거나 제거하는 일련의 작업을 가르킴. 

웹훅을 사용하는 시나리오에서는, `PSP가 콜백을 하지 않았을 경우를 대비`하여 주기적으로 결제 상태를 확인하는 하우스키핑 작업이 필요할 수 있음. 

`이러한 작업은 일정한 시간 간격으로 실행되며, 이는 웹훅 방식의 한계를 보완하는 역할` 을 함.

풀링과 웹훅은 서로 장단점이 있으며, 선택은 특정 상황과 요구에 따라 달라짐. 

`풀링`은 비교적 간단하지만 자원을 많이 사용하고, 

`웹훅`은 비동기적이지만 `콜백이 보장되지 않아 추가 대응책이 필요`함